doctype html
html
  head
    include ../../partials/head.jade
  body
    .container-fluid.scoreIdea
      .row
        .col-xs-2
          img.viability-icon(src="/" + viabilityIcon + ".png")
        .col-xs-8
          h2 Affordability
        .col-xs-2
          a.close-viability(href="/view-all-viabilities")
            img(src="/close_button.png" height="30" width="30")
      .row
        form.mobile-viability-form(role='form', id="formAffordability" action="/affordability-mobile", method="post", data-idea-doc=idea)
          h4.viability-question
            | Will the #{idea.name} stay within reasonable cost expectations when solving the problem of #{idea.name}?
          br
          input(type="hidden", name="_csrf", value="#{csrfToken}")
          .slider-container
            .slider-end-labels
              span.no-way Expensive
              span.yes-way Economical
            #affordLabelOne.sliderLabel
            #sliderOne
          .save-buttons
            .row
              a.btn.btn-industry.btn-lg Describe an Imperfection
            .row
              button.btn.btn-success.btn-lg Save

  
  include ../../partials/js-includes.jade
  script(type="text/javascript").
    var labelArr = _.range(101).map(function(number){
      return number.toString();
    });
    var initialValue, min=1, max=100, valueEntered = false;
    initialValue = '#{currentReview.affordOne}' || 50;

    ////////////////////////////////////////////
    // SET UP SLIDER ONE
    ////////////////////////////////////////////
    $("#sliderOne").slider({
      value: initialValue,
      min: min,
      max: max,
      step: 1,
      slide: function( event, ui ) {
          valueEntered = true;
          $(".sliderLabel").text(labelArr[ui.value]);
          $(".sliderLabel").css("margin-left", (ui.value-min)/(max-min)*100+"%");
          $(".sliderLabel").css("left", "-50px");
      }
    });
    $(".sliderLabel").text(labelArr[initialValue]);
    $(".sliderLabel" ).css("margin-left", (initialValue -1)/(max-min)*100+"%");
    $(".sliderLabel").css("left", "-50px");

    $('#sliderOne').draggable();

    $("button.btn-success").click(function(event){
      if(valueEntered){
        var sliderOneValue = $("#sliderOne").slider("value");
        var inputOne = $("<input>")
               .attr("type", "hidden")
               .attr("name", "affordSliderOneValue").val(sliderOneValue);
        $('#formAffordability').append($(inputOne)).submit();
      } else {
        $('#formAffordability').submit();
      }
    });

    $("a.btn.btn-industry.btn-lg").click(function(event){
      event.preventDefault();

      if(valueEntered){
        var sliderOneValue = $("#sliderOne").slider("value");
        var inputOne = $("<input>")
               .attr("type", "hidden")
               .attr("name", "affordSliderOneValue").val(sliderOneValue);
        var stop;
        //$('#formAffordability').append($(inputOne)).submit();
      } else {
        window.location = "/affordability-problem";
      }
    })